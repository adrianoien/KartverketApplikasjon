@using KartverketApplikasjon.Models

@model CorrectionReviewViewModel
@{
    ViewData["Title"] = "Review Correction";
}

<div class="container mt-4">
    <h2>Review Map Correction</h2>

    <div class="row">
        <div class="col-md-6">
            <div class="card mb-4">
                <div class="card-body">
                    <h5 class="card-title">Correction Details</h5>
                    <dl class="row">
                        <dt class="col-sm-4">Description</dt>
                        <dd class="col-sm-8">@Model.Description</dd>

                        <dt class="col-sm-4">Location</dt>
                        <dd class="col-sm-8">[@Model.Latitude, @Model.Longitude]</dd>

                        <dt class="col-sm-4">Submitted By</dt>
                        <dd class="col-sm-8">@Model.SubmittedBy</dd>

                        <dt class="col-sm-4">Submitted Date</dt>
                        <dd class="col-sm-8">@Model.SubmittedDate.ToString("g")</dd>

                        <dt class="col-sm-4">Current Status</dt>
                        <dd class="col-sm-8">@Model.Status</dd>
                    </dl>
                </div>
            </div>

            <div class="card">
                <div class="card-body">
                    <h5 class="card-title">Review Decision</h5>
                    <form asp-action="Review" method="post">
                        <input type="hidden" asp-for="Id" />

                        <div class="mb-3">
                            <label class="form-label">Status</label>
                            <select name="status" class="form-select" required>
                                <option value="">Select status...</option>
                                <option value="Approved">Approve</option>
                                <option value="Rejected">Reject</option>
                            </select>
                        </div>

                        <div class="mb-3">
                            <label class="form-label">Review Comment</label>
                            <textarea name="reviewComment" class="form-control"
                                      rows="3" required></textarea>
                        </div>

                        <div class="mb-3">
                            <button type="submit" class="btn btn-primary">Submit Review</button>
                            <a asp-action="Index" class="btn btn-secondary">Back to List</a>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <div class="col-md-6">
            <div class="card">
                <div class="card-body">
                    <h5 class="card-title">Location Map</h5>
                    <div id="map" style="height: 400px;"></div>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        // Initialize map
        var map = L.map('map').setView([@Model.Latitude, @Model.Longitude], 15);

        L.tileLayer('https://cache.kartverket.no/v1/wmts/1.0.0/topo/default/webmercator/{z}/{y}/{x}.png', {
            attribution: 'Map data © Kartverket'
        }).addTo(map);

        // Add marker for the correction
        L.marker([@Model.Latitude, @Model.Longitude])
            .addTo(map)
            .bindPopup('@Model.Description')
            .openPopup();
    </script>
}